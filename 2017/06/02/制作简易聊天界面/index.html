<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>制作简易聊天界面 - Ginny's blog</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com/Ginny07"><span>Github</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="http://callfiles.ueibo.com/hexo-theme-laughing/post_background.jpg"><div class="post-title"><h1 class="title">制作简易聊天界面</h1><ul class="meta"><li><i class="icon icon-author"></i>Ginny</li><li><i class="icon icon-clock"></i>5 Minutes</li><li><i class="icon icon-calendar"></i>June 2, 2017</li></ul></div></div><div class="article-content" style="max-width:600px"><ul>
<li>功能：仿制聊天界面，实现发送消息</li>
<li>实现：制作点9图作为气泡背景图片，ListView显示消息，判断消息类别（发送/收到）显示相应的item布局。</li>
</ul>
<h3 id="1）制作-9图"><a href="#1）制作-9图" class="headerlink" title="1）制作.9图"></a>1）制作.9图</h3><ol>
<li><strong>理解nine——patch（.9.png)</strong><br>.9.png是Android中一种特殊的png格式的图片，可以指定图片特定位置拉伸以及填充内容的位置。利用.9.png可以使图片在特定区域拉伸时不会失真。</li>
<li><strong>制作.9.png格式的气泡图片</strong><br>将背景图片放到res-drawable中，右键选择create 9-patch file。在.png图片四周增加了一个像素点的空白像素，通过在该空白像素区域内绘制黑点来指定特殊区域。<br><img src="http://oqwqpd0r4.bkt.clouddn.com/UF%7DY3_%28N@S3%7D5$RP3IN61%5DI.png" width="500"><br>左边线条：纵向拉伸区域。<br>上边线条：横向拉伸区域。<br>右边线条：填充内容纵向显示区域。<br>下边线条：填充内容横向显示区域。</li>
</ol>
<h3 id="2）判别消息类型，显示相应布局"><a href="#2）判别消息类型，显示相应布局" class="headerlink" title="2）判别消息类型，显示相应布局"></a>2）判别消息类型，显示相应布局</h3><p>1.<strong>item.xml</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">//接收到的消息布局</div><div class="line">&lt;LinearLayout</div><div class="line">        android:id="@+id/left_layout"</div><div class="line">        android:layout_width="wrap_content"</div><div class="line">        android:layout_height="wrap_content"</div><div class="line">        android:layout_gravity="left"</div><div class="line">        android:background="@drawable/left"</div><div class="line">        &gt;</div><div class="line">        &lt;TextView</div><div class="line">            android:layout_width="wrap_content"</div><div class="line">            android:layout_height="wrap_content"</div><div class="line">            android:layout_gravity="center"</div><div class="line">            android:layout_margin="10dp"</div><div class="line">            android:id="@+id/left_tv"</div><div class="line">            android:textColor="#787878"/&gt;</div><div class="line"></div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line">//发送的消息布局</div><div class="line">    &lt;LinearLayout</div><div class="line">        android:layout_width="wrap_content"</div><div class="line">        android:layout_height="wrap_content"</div><div class="line">        android:id="@+id/right_layout"</div><div class="line">        android:background="@drawable/right"</div><div class="line">        android:layout_gravity="right"&gt;</div><div class="line"></div><div class="line">        &lt;TextView</div><div class="line">            android:layout_width="wrap_content"</div><div class="line">            android:layout_height="wrap_content"</div><div class="line">            android:layout_gravity="center"</div><div class="line">            android:id="@+id/right_tv"</div><div class="line">            android:layout_margin="10dp"</div><div class="line">            android:textColor="#000"/&gt;</div><div class="line"></div><div class="line">    &lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<p>2.<strong>为消息设置type，区分收到的和发送的消息。通过setVisibility（）方法显示相应的布局。</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(msg.getType() == msg.TYPE_RECEIVED)&#123;</div><div class="line">            viewHolder.leftLyaout.setVisibility(View.VISIBLE);</div><div class="line">            viewHolder.rightLayout.setVisibility(View.GONE);</div><div class="line">            viewHolder.left_tv.setText(msg.getStr());</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(msg.getType() == msg.TYPE_SENT)&#123;</div><div class="line">            viewHolder.rightLayout.setVisibility(View.VISIBLE);</div><div class="line">            viewHolder.leftLyaout.setVisibility(View.GONE);</div><div class="line">            viewHolder.right_tv.setText(msg.getStr());</div><div class="line">        &#125;</div></pre></td></tr></table></figure></p>
<h3 id="3）效果图"><a href="#3）效果图" class="headerlink" title="3）效果图"></a>3）效果图</h3><p><img src="http://oqwqpd0r4.bkt.clouddn.com/E0A9AF54A9F1A433D84DB39907A75DFC.jpg" width="500"></p>
</div><div class="article-meta" style="max-width:600px"></div><div class="article-comment" style="max-width:600px"><div class="ds-thread" id="ds-thread" data-thread-key="cj3u61cez0000i8vr4wpwon7u" data-title="制作简易聊天界面" data-url="http://z.unfamous.cn/2017/06/02/制作简易聊天界面/" site-name="ueibo"></div><script>var siteName = document.getElementById('ds-thread').getAttribute('site-name');
var duoshuoQuery = {short_name: siteName};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2017/06/10/BroadcastReceiver总结/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2017/05/17/Volley-ListView制作留言栏/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/Ginny07" title="Github" target="_blank"><i class="icon icon-github"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2017 Ginny's blog<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div><div class="partial" cnzz></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>